syntax = "proto3";

import "protocol/primitives.proto";
import "protocol/gossip.proto";
import "protocol/blocks.proto";

service BlockStorage {
  rpc CommitOrderingBlock (CommitOrderingBlockInput) returns (CommitOrderingBlockOutput);
  rpc CommitValidationBlock (CommitValidationBlockInput) returns (CommitValidationBlockOutput);
  rpc GetOrderingBlockByHeight (GetBlockByHeightInput) returns (GetOrderingBlockOutput);
  rpc GetValidationBlockByHeight (GetBlockByHeightInput) returns (GetValidationBlockOutput);
  rpc GetOrderingBlockByID (GetBlockByIDInput) returns (GetOrderingBlockOutput);
  rpc GetValidationBlockByID (GetBlockByIDInput) returns (GetValidationBlockOutput);
  rpc GetTopBlock(GetTopBlockInput) returns (GetTopBlockOutput);
  rpc ProcessGossipMessage (ProcessGossipMessageInput) returns (ProcessGossipMessageOutput);
  rpc SubscribeEvents(SubscribeEventsInput) returns (SubscribeEventsOutput);
  rpc UnSubscribeEvents(SubscribeEventsInput) returns (SubscribeEventsOutput);
}

message CommitOrderingBlockInput {
  OrderingBlock ordering_block = 1;
}

message CommitOrderingBlockOutput {
 
}

message CommitValidationBlockInput {
  ValidationBlock validation_block = 1;
}

message CommitValidationBlockOutput {

}

message GetBlockByHeightInput {
  Uint64 block_height = 1;
  BlockFormat format = 2;
}

enum BlockFormat {
  STRUCT = 0;
  BINARY = 1;
}

message GetOrderingBlockOutput {
  OrderingBlock ordering_block = 1;
}

message GetValidationBlockOutput {
  ValidationBlock validation_block = 1;
}

message GetBlockByIDInput {
  SHA256 block_id = 1;
}

message GetTopBlockInput { 
  // empty 
}

message GetTopBlockOutput {
  Uint64 block_height = 1;
  SHA256 block_id = 1;
}

message SubscribeEventsInput {
  Ed25519PKey subscriber_id = 1;
  repeated Event events = 2;
}

message SubscribeEventsOutput {
  Uint64 token = 1;
}

message Event {
  Address contract_address = 1; // Valid only for per SC events - index > 10.
  Uint32 event_index = 2;
  Uint256 event_id = 3;
  //Uint32 exeperation = 3;
}

message UnSubscribeEventsInput {
  Uint64 token = 1;
}

message UnSubscribeEventsOutput {
  // empty
}

message EventData {
  Uint32 event_index = 1;
  Uint256 event_id = 2;
}


{

}