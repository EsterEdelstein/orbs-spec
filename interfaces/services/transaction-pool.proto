syntax = "proto3";

import "primitives/transactions.proto";
import "primitives/gossip-listener.proto";
import "services/configuration-manager.proto";

service TransactionPool {
  rpc AddNewTransaction (AddNewTransactionInput) returns (AddNewTransactionOutput);
  rpc CollectTransactions (CollectTransactionsInput) returns (stream Transaction);
  rpc ValidateTransactionsCollection (ValidateTransactionsCollectionInput) returns (ValidateTransactionsCollectionOutput);
  rpc CommitTransactionReceipts (CommitTransactionReceiptsInput) returns (CommitTransactionReceiptsOutput);
  rpc GetTransactionStatus (GetTransactionStatusInput) returns (GetTransactionStatusOutput);
  rpc GossipMessageReceived (GossipListenerInput) returns (GossipListenerOutput);
}

message AddNewTransactionInput {
  Transaction transaction = 1;
}

message AddNewTransactionOutput {
  SHA256 tx_id = 1;
}

message CollectTransactionsInput {
  Uint64 block_height = 1;
  Uint32 number_of_transactions = 2;
}

/*
message CollectTransactionsOutput {
  TransactionPoolStatus tx_pool_status = 1;
  repeated Transaction transactions = 2;
}

enum TransactionPoolStatus {
  VALID = 0;
  OUT_OF_SYNC = 1;
  UNEXEPCETED_BLOCK_HEIGHT = 2;
}
*/

message ValidateTransactionsCollectionInput {
  repeated Transaction transactions = 1;
}

message ValidateTransactionsCollectionOutput {
  TransactionPoolStatus tx_pool_status = 1;
  TransactionsOrderingStatus status = 2;
}

enum TransactionsOrderingStatus {
  VALID = 0;
  INVALID = 1;
}

message GetTransactionStatusInput {
  SHA256 txid = 1;
}

message GetTransactionStatusOutput {
  TransactionStatus transaction_status = 1;

}

message CommitTransactionReceiptsInput {
  ResultsBlock validation_block = 1; // Nullify sc_state_diff
}

message CommitTransactionReceiptsOutput {
  Unit64 consumer_block_height = 1;
  Uint64 target_block_height = 2;
}


message GetTransactionStatusInput {
  SHA256 txid = 1;
  Uint64 time_stamp = 2;
}

message GetTransactionStatusOutput {
  TransactionReceipt receipt = 1;
}
